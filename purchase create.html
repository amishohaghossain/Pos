<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- CSRF Token -->
    <meta name="csrf-token" content="bTj3O008Gok8UPD3kCvdtTE0TMZk1CLZi2jZdUNc">

    <title>SOFTGHOR Digital POS Software | Create Purchase</title>

    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css?family=Roboto:100,300,400,500,300i" rel="stylesheet">

    <!-- Styles -->
    <link rel="stylesheet" href="icon css/all.min.css">
     <link rel="stylesheet" href="icon css/fontawesome.min.css">
    <link href="https://pos.softghor.com/dashboard/css/core.min.css" rel="stylesheet">
    <link href="https://pos.softghor.com/dashboard/css/select2.min.css" rel="stylesheet">
    <link href="https://pos.softghor.com/dashboard/css/app.min.css" rel="stylesheet">
    <link href="https://pos.softghor.com/dashboard/css/style.min.css" rel="stylesheet">
    <link href="https://pos.softghor.com/dashboard/css/toastr.css" rel="stylesheet">
    <link href="https://pos.softghor.com/dashboard/css/custom.css" rel="stylesheet">
    <!-- Favicons -->
    <link rel="apple-touch-icon" href="https://pos.softghor.com/dashboard/images/logo-light-lg.png">
    <link rel="icon" href="https://pos.softghor.com/dashboard/images/logo-light-lg.png">




    <style>
        .table tr td {
            text-align: center;
            vertical-align: baseline;
            padding: 4px;
        }

        .table tr th {
            text-align: center;
            padding: 5px;
        }

        .table tr td input {
            text-align: center;
        }

        .header {
            margin-bottom: 10px;
        }

        .main-content {
            padding-top: 10px;
        }
    </style>
    <link rel="stylesheet" href="//code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">

</head>

<body>

    <!-- Preloader -->
    <div class="preloader">
        <div class="spinner-dots">
            <span class="dot1"></span>
            <span class="dot2"></span>
            <span class="dot3"></span>
        </div>
    </div>


    <!-- Sidebar -->
    <!-- Sidebar -->
    <aside class="sidebar sidebar-expand-lg sidebar-dark">
        <header class="sidebar-header bg-dark">
            
            <span class="logo">
      <a href="index.html">
        <h3 class="text-white">Princebros</h3>
      </a>
    </span>
            <span class="sidebar-toggle-fold"></span>
        </header>

        <nav class="sidebar-navigation">



            <ul class="menu">
                <li class="menu-item active">
                    <a class="menu-link" href="index.html">
                    <span><i class="fas fa-house-user"></i></span>
                    <span class="title">Dashboard</span>
                </a>
                </li>

                <li class="menu-category">Sale & Purchase</li>
                <li class="menu-item ">
                    <a class="menu-link" href="create.html">
                        <span><i class="fas fa-cart-plus"></i></span>
                        <span class="title"> POS</span>
                    </a>
                </li>
                <li class="menu-item ">
                    <a class="menu-link" href="pos.html">
                        <span><i class="fas fa-shopping-bag"></i></span>
                        <span class="title"> Sales</span>
                    </a>
                </li>
                <li class="menu-item ">
                    <a class="menu-link" href="return.html">
                        <span><i class="fas fa-backward"></i></span>
                        <span class="title"> Returns</span>
                    </a>
                </li>



                <li class="menu-item ">
                    <a class="menu-link" href="#">
                        <span><i class="fas fa-suitcase"></i></span>
                        <span class="title">Purchase</span>
                        <span><i class="fas fa-sort-down"></i></span>
                    </a>

                    <ul class="menu-submenu">
                        <li class="menu-item ">
                            <a class="menu-link" href="purchase create.html">
                                <span class="dot"></span>
                                <span class="title">Add Purchase</span>
                            </a>
                        </li>

                        <li class="menu-item">
                            <a class="menu-link" href="won purchase.html">
                                <span class="dot"></span>
                                <span class="title">Manage Purchases</span>
                            </a>
                        </li>
                    </ul>

                </li>

                <li class="menu-item ">
                    <a class="menu-link" href="stock.html">
                        <span><i class="fas fa-university"></i></span>
                        <span class="title"> Stock</span>
                    </a>
                </li>

                <li class="menu-item ">
                    <a class="menu-link" href="#">
                        <span><i class="fas fa-folder"></i></span>
                        <span class="title">Damages</span>
                        <span><i class="fas fa-sort-down"></i></span>
                    </a>

                    <ul class="menu-submenu">
                        <li class="menu-item ">
                            <a class="menu-link" href="add damage.html">
                                <span class="dot"></span>
                                <span class="title">Add Damage</span>
                            </a>
                        </li>

                        <li class="menu-item ">
                            <a class="menu-link" href="damage list.html">
                                <span class="dot"></span>
                                <span class="title">Damages</span>
                            </a>
                        </li>

                    </ul>
                </li>

                <li class="menu-category">Product Information</li>
                <li class="menu-item ">
                    <a class="menu-link" href="#">
                        <span><i class="fas fa-swatchbook"></i></span>
                        <span class="title">Products</span>
                        <span><i class="fas fa-sort-down"></i></span>
                    </a>

                    <ul class="menu-submenu">

                        <li class="menu-item ">
                            <a class="menu-link" href="add product.html">
                                <span class="dot"></span>
                                <span class="title">Add Product</span>
                            </a>
                        </li>

                        <li class="menu-item ">
                            <a class="menu-link" href="all product.html">
                                <span class="dot"></span>
                                <span class="title">Manage Products</span>
                            </a>
                        </li>

                    </ul>
                </li>

                <li class="menu-item ">
                    <a class="menu-link" href="#">
                        <span><i class="fas fa-folder"></i></span>
                        <span class="title">Cateogries</span>
                        <span><i class="fas fa-sort-down"></i></span>
                    </a>

                    <ul class="menu-submenu">
                        <li class="menu-item ">
                            <a class="menu-link" href="add category.html">
                                <span class="dot"></span>
                                <span class="title">Add Cateogry</span>
                            </a>
                        </li>

                        <li class="menu-item ">
                            <a class="menu-link" href="categories.html">
                                <span class="dot"></span>
                                <span class="title">Manage Cateogries</span>
                            </a>
                        </li>

                    </ul>
                </li>

                <li class="menu-item ">
                    <a class="menu-link" href="#">
                        <span><i class="fas fa-folder"></i></span>
                        <span class="title">Brands</span>
                        <span><i class="fas fa-sort-down"></i></span>
                    </a>

                    <ul class="menu-submenu">
                        <li class="menu-item ">
                            <a class="menu-link" href="add brand.html">
                                <span class="dot"></span>
                                <span class="title">Add Brand</span>
                            </a>
                        </li>

                        <li class="menu-item ">
                            <a class="menu-link" href="brands.html">
                                <span class="dot"></span>
                                <span class="title">Manage Brands</span>
                            </a>
                        </li>

                    </ul>
                </li>

                <li class="menu-category">Expenses & Payment</li>


                <li class="menu-item">
                    <a class="menu-link" href="#">
                        <span><i class="fas fa-folder"></i></span>
                        <span class="title">Expenses</span>
                        <span><i class="fas fa-sort-down"></i></span>
                    </a>

                    <ul class="menu-submenu">
                        <li class="menu-item ">
                            <a class="menu-link" href="add expense.html">
                                <span class="dot"></span>
                                <span class="title">Add Expense</span>
                            </a>
                        </li>

                        <li class="menu-item ">
                            <a class="menu-link" href="expense.html">
                                <span class="dot"></span>
                                <span class="title">Manage Expenses</span>
                            </a>
                        </li>

                        <li class="menu-item ">
                            <a class="menu-link" href="expense-category.html">
                                <span class="dot"></span>
                                <span class="title">Expense Category</span>
                            </a>
                        </li>
                    </ul>
                </li>

                <li class="menu-item">
                    <a class="menu-link" href="#">
                        <span><i class="fas fa-file-invoice-dollar"></i></span>
                        <span class="title">Payments</span>
                        <span><i class="fas fa-sort-down"></i></span>
                    </a>

                    <ul class="menu-submenu">
                        <li class="menu-item ">
                            <a class="menu-link" href="add payment.html">
                                <span class="dot"></span>
                                <span class="title">Add Payment</span>
                            </a>
                        </li>

                        <li class="menu-item ">
                            <a class="menu-link" href="payment.html">
                                <span class="dot"></span>
                                <span class="title">Payments</span>
                            </a>
                        </li>

                    </ul>
                </li>



                <li class="menu-category">Peoples</li>



                <li class="menu-item ">
                    <a class="menu-link" href="#">
                        <span><i class="fas fa-folder"></i></span>
                        <span class="title">Customers</span>
                        <span><i class="fas fa-sort-down"></i></span>
                    </a>

                    <ul class="menu-submenu">
                        <li class="menu-item ">
                            <a class="menu-link" href="add customer.html">
                                <span class="dot"></span>
                                <span class="title">Add Customer</span>
                            </a>
                        </li>
                        <li class="menu-item ">
                            <a class="menu-link" href="customer.html">
                                <span class="dot"></span>
                                <span class="title">Manage Customers</span>
                            </a>
                        </li>
                    </ul>
                </li>

                <li class="menu-item ">
                    <a class="menu-link" href="#">
                        <span><i class="fas fa-wheelchair"></i></span>
                        <span class="title">Suppliers</span>
                        <span><i class="fas fa-sort-down"></i></span>
                    </a>

                    <ul class="menu-submenu">
                        <li class="menu-item">
                            <a class="menu-link " href="add supplier.html">
                                <span class="dot"></span>
                                <span class="title">Add Supplier</span>
                            </a>
                        </li>

                        <li class="menu-item">
                            <a class="menu-link " href="supplier.html">
                                <span class="dot"></span>
                                <span class="title">Manage Suppliers</span>
                            </a>
                        </li>

                    </ul>
                </li>

                <li class="menu-category">Reports</li>
                <li class="menu-item ">
                    <a class="menu-link" href="today_report.html">
                        <span><i class="far fa-clock"></i></span>
                        <span class="title"> Today Report</span>
                    </a>
                </li>
                <li class="menu-item ">
                    <a class="menu-link" href="current_month_report.html">
                        <span><i class="fas fa-calendar-alt"></i></span>
                        <span class="title"> Current Month Report</span>
                    </a>
                </li>
                <li class="menu-item ">
                    <a class="menu-link" href="summery-report.html">
                        <span><i class="fas fa-file-pdf"></i></span>
                        <span class="title"> Summary Report</span>
                    </a>
                </li>

                <li class="menu-item ">
                    <a class="menu-link" href="daily_report.html">
                        <span><i class="fas fa-file-pdf"></i></span>
                        <span class="title"> Daily Report</span>
                    </a>
                </li>

                <li class="menu-item ">
                    <a class="menu-link" href="customer_due.html">
                        <span><i class="fas fa-file-pdf"></i></span>
                        <span class="title">Due Customer Report</span>
                    </a>
                </li>

                <li class="menu-item ">
                    <a class="menu-link" href="low_stock.html">
                        <span><i class="fas fa-file-pdf"></i></span>
                        <span class="title">Low Stock Report</span>
                    </a>
                </li>

                <li class="menu-item ">
                    <a class="menu-link" href="most_purchase.html">
                        <span><i class="fas fa-file-pdf"></i></span>
                        <span class="title">Top Customer</span>
                    </a>
                </li>

                <li class="menu-item ">
                    <a class="menu-link" href="purchase_report.html">
                        <span><i class="fas fa-file-pdf"></i></span>
                        <span class="title">Purchase Report</span>
                    </a>
                </li>







                <li class="menu-category">Setting & Customize</li>

                <li class="menu-item ">
                    <a class="menu-link" href="pos-setting.html">
                        <span><i class="fas fa-user-cog"></i></span>
                        <span class="title"> Settings</span>
                    </a>
                </li>

                <li class="menu-item ">
                    <a class="menu-link" href="#">
                        <span><i class="fas fa-cloud"></i></span>
                        <span class="title"> Backup</span>
                    </a>
                </li>
            </ul>
        </nav>

    </aside>
    <!-- END Sidebar -->
    <!-- END Sidebar -->



    <!-- Topbar -->
    <!-- Topbar -->
    <header class="topbar topbar-inverse gb-dark" id="topbar-colors">
        <div class="topbar-left">
            <span class="topbar-btn sidebar-toggler" style="color:white;"><i>☰</i></span>





            <div class="dropdown d-none d-md-block">
                <h3 style="color:white;text-align:center; font-weight:bold; display:inline-block;">SOFTGHOR Digital POS Software</h3>
                <p style="color:white; margin-left:15px; font-size:1.2em;display:inline-block; display:inline-block;">For Support: 01786-878393 (10 AM - 06 PM)</p>

            </div>


            <di class="topbar-divider d-none d-md-block"></di>
        </div>

        <div class="topbar-right">
            <a class="topbar-btn" href="#" data-toggle="test"><i class="ti-align-right"></i></a>

            <div class="topbar-divider"></div>

            <ul class="topbar-btns">
                <li class="dropdown">
                    <span class="topbar-btn" data-toggle="dropdown"><img class="avatar"
            src="https://pos.softghor.com/dashboard/img/avatar/1.jpg" alt="avater"></span>
                    <div class="dropdown-menu dropdown-menu-right">
                        <a class="dropdown-item" href="https://pos.softghor.com/back/profile"><i class="ti-user"></i> Profile</a>

                        <a class="dropdown-item" href="https://pos.softghor.com/back/pos-setting"><i class="ti-settings"></i> Settings</a>
                        <div class="dropdown-divider"></div>

                        <a class="dropdown-item" href="#" onclick="event.preventDefault(); document.getElementById('logout-form').submit();"><i
              class="ti-power-off"></i> Logout</a>

                        <form method="POST" id="logout-form" style="display:none" action="https://pos.softghor.com/logout">
                            <input type="hidden" name="_token" value="bTj3O008Gok8UPD3kCvdtTE0TMZk1CLZi2jZdUNc"> </form>
                    </div>
                </li>

                <!-- Notifications -->

                <!-- END Notifications -->

                <!-- Messages -->

                <!-- END Messages -->

            </ul>

            <div class="topbar-divider"></div>
        </div>
    </header>
    <!-- END Topbar -->
    <!-- END Topbar -->


    <!-- Main container -->
    <main class="main-container" id="app">
        <header class="header bg-ui-general">
            <div class="header-info">
                <h1 class="header-title">
                    <strong>Purchase</strong>
                </h1>
            </div>

            <div class="header-action">
                <nav class="nav">
                    <a class="nav-link" href="https://pos.softghor.com/back/purchase">
        Purchases
      </a>
                    <a class="nav-link active" href="https://pos.softghor.com/back/purchase/create">
        <i class="fa fa-plus"></i>
        Add Purchase
      </a>
                </nav>
            </div>

        </header>
        <div class="main-content">
            <div class="row">
                <div class="col-12">
                    <div class="card">
                        <div class="row">
                            <div class="col-md-12">
                                <h4 class="card-title" style="display: inline-block">Create Purchase</h4>
                                <a href="https://pos.softghor.com/back/purchase/add_supplier" class="edit btn btn-outline btn-primary float-right mt-2" data-toggle="modal" data-target="#edit" id="Add Supplier" style="margin-left: 30px;">Add Supplier</a>


                            </div>
                        </div>
                        <form action="https://pos.softghor.com/back/purchase" method="POST" onkeydown="return event.key != 'Enter';">
                            <input type="hidden" name="_token" value="bTj3O008Gok8UPD3kCvdtTE0TMZk1CLZi2jZdUNc">
                            <div class="card-body">
                                <div class="form-row">
                                    <div class="form-group col-md-6">
                                        <label for="supplier">Supplier</label>
                                        <select name="supplier_id" id="supplier" data-provide="selectpicker" data-live-search="true" class="form-control " data-size="10">
              <option value="">Select Supplier </option>
                            <option value="1">Ripath Hasan</option>
                            <option value="2">Sakib Al Hasan</option>
                            <option value="3">Md Hossain</option>
                            <option value="4">Md Sahadat</option>
                            <option value="5">Aftab Kahn</option>
                            <option value="6">Monsur Ali</option>
                            <option value="7">Kashem</option>
                            <option value="8">TOPU</option>
                            <option value="9">Rohmot</option>
                            <option value="10">Default Supplier</option>
                          </select>
                                    </div>
                                    <div class="form-group col-md-6">
                                        <label for="">Purchase Date</label>
                                        <input type="text" class="form-control  date" data-provide="datepicker" name="purchase_date" data-date-today-highlight="true" data-date-format="yyyy-mm-dd" value="2021-11-02">
                                    </div>

                                </div>
                                <div class="form-row">
                                    <div class="form-group col-md-6">
                                        <label for="Product">Product</label>
                                        <input type="text" id="product_search" class="form-control" placeholder="Write product.">
                                    </div>

                                </div>
                                <hr>

                                <div class="row">
                                    <table class="table table-bordered">
                                        <thead>
                                            <tr class="bg-primary">
                                                <th style="width:80px">#SL</th>
                                                <th>Product</th>
                                                <th>Rate</th>
                                                <th>Qty</th>
                                                <th>Sub Total</th>
                                                <th style="width:50px">
                                                    <i class="fa fa-trash"></i>
                                                </th>
                                            </tr>
                                        </thead>
                                        <tbody id="table_body">

                                        </tbody>
                                        <tfoot class="bg-light">
                                            <tr>
                                                <td colspan="2"></td>
                                                <td>
                                                    <span>Total Items: </span> <span id="total_items">0</span>
                                                </td>
                                                <td>
                                                    <span>Total Qty: </span> <span id="total_qty">0</span>
                                                </td>
                                                <td colspan="2">
                                                    <strong>Grand Total: <span id="total">0</span> Tk</strong>
                                                </td>
                                            </tr>
                                        </tfoot>
                                    </table>
                                </div>

                                <div class="form-row">
                                    <div class="form-group col-md-12 mt-4">
                                        <button type="button" id="payment_btn" class="btn btn-primary mx-auto">
            <i class="fa fa-money"></i>
            Payment
          </button>
                                    </div>
                                </div>
                            </div>

                            <div class="modal fade" id="payment-modal" tabindex="-1">
                                <div class="modal-dialog modal-md">
                                    <div class="modal-content">
                                        <div class="modal-header">
                                            <h4 class="modal-title" id="myModalLabel">Payment</h4>
                                            <button type="button" class="close" data-dismiss="modal">
            <span aria-hidden="true">×</span>
          </button>
                                        </div>
                                        <div class="modal-body">
                                            <table class="table table-bordered text-left">
                                                <tr>
                                                    <td width="50%">
                                                        <strong class="float-left">Paying Items: </strong>
                                                        <strong class="float-right">(<span id="items">0</span>)</strong>
                                                    </td>
                                                    <td>
                                                        <strong class="float-left">Total Payable: </strong>
                                                        <strong class="float-right">(<span id="payable">0</span> Tk)</strong>
                                                        <input type="hidden" name="payable" id="payable_input">
                                                    </td>
                                                </tr>
                                                <tr>
                                                    <td colspan="2">
                                                        <strong class="float-left pl-3">Due</strong>
                                                        <strong class="float-right pr-3">
                  (<span id="due">0</span> Tk)
                </strong>
                                                        <input type="hidden" id="due_input" name="due_amount">
                                                    </td>
                                                </tr>
                                            </table>
                                            <div class="form-row">
                                                <div class="form-group col-12">
                                                    <label for="note">Note</label>
                                                    <textarea name="note" class="form-control" placeholder="Enter Note (Optional) "></textarea>
                                                </div>
                                            </div>
                                            <div class="form-row">
                                                <div class="form-group col-md-6">
                                                    <label for="payment_method">Payment Method</label>
                                                    <select class="form-control" name="payment_method">
                
                                <option value="1">Hand Cash</option>
                                <option value="2">Bank</option>
                                <option value="3">Rocket</option>
                                <option value="4">Bkash</option>
                                <option value="5">Cash On Delivery</option>
                              </select>
                                                </div>
                                                <div class="form-group col-md-6">
                                                    <label for="pay_amount">Pay Amount</label>
                                                    <div class="input-group">
                                                        <input type="number" step="any" class="form-control" name="pay_amount" id="pay_amount" placeholder="Pay Amount...">
                                                        <span class="input-group-btn">
                  <button class="btn btn-warning" type="button" id="paid_btn">PAID!</button>
                </span>
                                                    </div>
                                                </div>
                                            </div>
                                            <hr>
                                        </div>
                                        <div class="modal-footer">
                                            <button type="button" class="btn btn-bold btn-secondary" data-dismiss="modal">Cancel</button>
                                            <button type="submit" class="btn btn-bold btn-primary" id="order-btn">
            <i class="fa fa-shopping-cart"></i>
            Purchase
          </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
        <!--/.main-content -->

        <!-- Footer -->
        <footer class="site-footer">
            <div class="row">
                <div class="col-md-6">
                    <p class="text-center text-md-left">Copyright © 2021 <a href="https://softghor.com/" target="__blank">SOFTGHOR</a>. All development rights reserved.</p>
                </div>
            </div>
        </footer>
        <!-- END Footer -->
    </main>
    <!-- END Main container -->
    <!-- Scripts -->
    <script src="https://pos.softghor.com/js/app.js"></script>
    <script src="https://pos.softghor.com/dashboard/js/core.min.js"></script>
    <script src="https://pos.softghor.com/dashboard/js/app.js"></script>
    <script src="https://pos.softghor.com/dashboard/js/script.min.js"></script>
    <script src="https://pos.softghor.com/dashboard/js/select2.min.js"></script>
    <script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>
    <script>
        $(".select2").select2();
    </script>



    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
    <script>
        var count = 0;
        var db_pid_array;
        console.log(db_pid_array)

        function getPurchaseItemId(purchaseId) {
            let url = "https://pos.softghor.com/back/purchase-item-product/pid".replace('pid', purchaseId);
            $.get(url, function(data) {
                // console.log(data);
                db_pid_array = data;
            });
        }

        app.ready(function() {

            $("#product_search").autocomplete({
                source: function(req, res) {
                    let url = "https://pos.softghor.com/back/product-search";
                    $.get(url, {
                        req: req.term
                    }, (data) => {
                        res($.map(data, function(item) {
                            return {
                                id: item.id,
                                value: item.name + " - " + item.code,
                                price: item.price
                            }
                        })); // end res

                    });
                },
                select: function(event, ui) {
                    //check is supplier is selected.
                    if ($("#supplier").val() == '') {
                        toastr.warning('Please Select Supplier First !');
                        $(this).val('');
                        return false;
                    }

                    if (db_pid_array && db_pid_array.includes(ui.item.id)) {
                        //SHOW ERROR
                        toastr.warning('Please Increase the quantity.');
                        return;
                    }

                    count++;
                    $(this).val(ui.item.value);
                    $("#search_product_id").val(ui.item.id);
                    let url = "https://pos.softghor.com/back/back/product/id".replace('id', ui.item.id);
                    $.get(url, (product) => {
                        // product add
                        let row = `
              <tr>
                <td>${count}</td>
                <td>
                ${product.name + " - " + product.code}
                <input type="hidden" value="${product.id}" name="v_product[]" class="product">
                <input type="hidden" value="${product.name}" name="update_purchase[]" />
                </td>
                <td style="width:150px">
                  <input type="text" value="${product.cost}" class="form-control rate" name="v_rate[]">
                </td>
                <td style="width:150px">
                  <input type="number" value="1" class="form-control sale_qty" name="v_qty[]">
                </td>
                <td>
                  <strong><span class="sub_total">${product.cost}</span> Tk</strong>
                  <input type="hidden" name="v_subtotal_input[]" class="subtotal_input" value="${product.cost}">
                </td>
                <td>
                  <a href="#" class="remove">
                    <i class="fa fa-trash"></i>
                  </a>
                </td>
              </tr>
        `;


                        // Duplicate check
                        let tableBody = document.querySelector('#table_body');
                        let products = tableBody.querySelectorAll('.product');
                        let isDuplicate = false;
                        products.forEach(function(item) {
                            if (ui.item.id == item.value) {
                                isDuplicate = true;
                            } else {
                                isDuplicate = false;
                            }
                        });

                        if (isDuplicate) {
                            toastr.warning('Please Increase the quantity.');
                        } else {
                            $("#table_body").append(row);
                        }

                        itemUpdate();
                        updateTotalQty();
                        // Update Total
                        updateTotal();

                    });
                    $(this).val('');

                    return false;
                },
                response: function(event, ui) {
                    if (ui.content.length == 1) {
                        ui.item = ui.content[0];
                        $(this).data('ui-autocomplete')._trigger('select', 'autocompleteselect', ui);
                        $(this).autocomplete('close');

                    }
                },
                minLength: 0
            });
        });


        // change rate
        $(document).on('change', '.rate', function() {
            let subTotal = $(this).val() * $(this).parents('tr').find('.sale_qty').val();
            $(this).parents('tr').children('td').find('.sub_total').text(subTotal);
            $(this).parents('tr').children('td').find('.subtotal_input').val(subTotal);
            updateTotalQty();
            updateTotal();
        });

        // change qty
        $(document).on('change', '.sale_qty', function() {
            // let rate = $(this).parents('tr').find('.rate').val();
            let subTotal = $(this).val() * $(this).parents('tr').find('.rate').val();
            $(this).parents('tr').children('td').find('.sub_total').text(subTotal);
            $(this).parents('tr').children('td').find('.subtotal_input').val(subTotal);
            updateTotalQty();
            updateTotal();
        });

        // Remove DOM
        $(document).on('click', '.remove', function() {
            $(this).parents('tr').remove();
            updateTotal();
            updateTotalQty();
            itemUpdate();
            count--;
        });

        // update total qty function
        function updateTotalQty() {
            let totalQty = 0;
            $(".sale_qty").each((i, obj) => {
                let qty_val = parseInt(obj.value);
                totalQty += qty_val;
            });
            $("#total_qty").text(totalQty);
        }

        //  Update item function
        function itemUpdate() {
            let totalItems = 0
            $(".sale_qty").each((i, obj) => {
                totalItems += 1;
            });
            $("#total_items").text(totalItems);
        }

        // update total amount
        function updateTotal() {
            let totalAmount = 0;
            $(".sub_total").each((i, obj) => {
                let subtotal = obj.innerHTML;
                totalAmount += parseFloat(subtotal);
            });
            $("#total").text(totalAmount)
        }

        // payment
        $("#payment_btn").click(function() {
            let divLength = $(".product").length;
            // if purches list is empty
            if (divLength == 0) {
                toastr.warning('Please Select Product. Thanks !');
                return;
            }

            let total = $("#total").text();
            let totalItems = $("#total_items").text();
            $("#items").text(totalItems);

            $("#payable").text(total);
            $("#payable_input").val(total);
            // init due all amount
            $("#due").text(total);
            $("#due_input").val(total);
            $("#payment-modal").modal('show');

        });

        // Due Calcualation
        $("#pay_amount").change(function() {
            let payAmount = 0
            if ($(this).val() != '') {
                payAmount = parseFloat($(this).val());
            }
            let payAbleAmount = parseFloat($("#total").text());
            let due = payAbleAmount - payAmount;
            $("#due").text(due);
            $("#due_input").val(due);
        });

        // click paid button
        $("#paid_btn").click(function() {
            let payAbleAmount = parseFloat($("#total").text());

            $("#pay_amount").val(payAbleAmount);

            $("#due").text(0);
            $("#due_input").val(0);
        });
    </script>

    <script src="https://pos.softghor.com/js/modal_form.js"></script>

    <div class="modal fade" id="edit" role="dialog" aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLongTitle"></h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
                </div>
                <div class="modal-body">
                    <div class="modal-loader" style="display: none; text-align: center;">
                        <img src="/loading.gif">
                    </div>

                    <!-- content will be load here -->
                    <div class="dynamic-content"></div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>

                </div>
            </div>
        </div>
    </div>

</body>

</html>